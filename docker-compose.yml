version: '3.8'

services:
  arxiv-threat-intel:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: arxiv-threat-intel
    image: ghcr.io/kulikov/arxiv-threat-intel:latest
    ports:
      - "3838:3838"
    volumes:
      # Монтирование директорий для данных
      - ./data-raw:/app/data-raw
      - ./inst/data:/app/inst/data
      # Монтирование кода для разработки (опционально)
      - ./R:/app/R
      - ./tests:/app/tests
    environment:
      - TZ=UTC
    # Default command запускает Shiny dashboard
    # Для интерактивной R сессии используйте: docker-compose run arxiv-threat-intel R

  # Сервис для запуска тестов
  test:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: arxiv-threat-intel-test
    volumes:
      - ./data-raw:/app/data-raw
      - ./inst/data:/app/inst/data
      - ./R:/app/R
      - ./tests:/app/tests
    environment:
      - TZ=UTC
    command: Rscript -e "testthat::test_dir('tests/testthat')"

  # Сервис для запуска быстрых тестов
  quick-test:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: arxiv-threat-intel-quick-test
    volumes:
      - ./data-raw:/app/data-raw
      - ./tests:/app/tests
      - ./R:/app/R
    environment:
      - TZ=UTC
    command: Rscript tests/manual/quick_test_categorization.R